<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Анализ запчастей</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  button { padding: 10px 20px; font-size: 16px; }
  #progress { margin-top: 20px; width: 100%; background: #eee; border-radius: 5px; overflow: hidden; }
  #bar { width: 0; height: 24px; background: #4caf50; text-align: center; color: white; }
  #log { margin-top: 20px; height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; background: #f9f9f9; }
</style>
</head>
<body>
<h1>Анализ запчастей</h1>
<button id="startBtn">Запустить анализ</button>
<div id="progress"><div id="bar">0%</div></div>
<div id="log"></div>

<script>
const startBtn = document.getElementById('startBtn');
const bar = document.getElementById('bar');
const log = document.getElementById('log');

startBtn.onclick = async () => {
    log.innerHTML = '';
    bar.style.width = '0%';
    bar.textContent = '0%';

    const response = await fetch('/start', { method: 'POST' });
    const data = await response.json();

    if(data.status === 'started') {
        const interval = setInterval(async () => {
            const progressRes = await fetch('/progress');
            const progressData = await progressRes.json();
            
            bar.style.width = progressData.percent + '%';
            bar.textContent = progressData.percent + '%';

            log.innerHTML = progressData.log.join('<br>');

            if(progressData.done) clearInterval(interval);
        }, 1000);
    } else {
        alert('Не удалось запустить анализ: ' + data.message);
    }
};
</script>
</body>
</html>
