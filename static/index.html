<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Yandex Vision Analyzer</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h2>üîç –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Yandex Vision API)</h2>
    <form id="uploadForm">
        <input type="file" id="images" name="images" multiple accept="image/*">
        <button type="submit">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>
    </form>

    <div id="progress"></div>
    <div id="results"></div>

    <hr>
    <button id="checkLimits">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã</button>
    <div id="limits"></div>

    <script>
        const form = document.getElementById('uploadForm');
        const progressDiv = document.getElementById('progress');
        const resultsDiv = document.getElementById('results');
        const limitsDiv = document.getElementById('limits');
        const checkLimits = document.getElementById('checkLimits');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            progressDiv.innerText = "‚è≥ –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...";
            resultsDiv.innerHTML = "";

            const formData = new FormData(form);
            const res = await fetch('/analyze', { method: 'POST', body: formData });
            const data = await res.json();

            if (data.status === "ok") {
                progressDiv.innerText = "‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω";
                data.results.forEach(r => {
                    const p = document.createElement('p');
                    if (r.status === "ok") {
                        p.textContent = `üñº ${r.filename}: ${r.description}`;
                    } else {
                        p.textContent = `‚ö†Ô∏è ${r.filename}: ${r.message}`;
                    }
                    resultsDiv.appendChild(p);
                });
            } else {
                progressDiv.innerText = "‚ùå –û—à–∏–±–∫–∞: " + data.message;
            }
        });

        checkLimits.addEventListener('click', async () => {
            const res = await fetch('/limits');
            const data = await res.json();
            limitsDiv.innerText = `‚è± –û—Å—Ç–∞–ª–æ—Å—å ${data.token_valid_minutes} –º–∏–Ω. –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞\n${data.message}`;
        });
    </script>
</body>
</html>
