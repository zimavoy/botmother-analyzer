<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äî Yandex Vision</title>
    <link rel="stylesheet" href="/static/style.css" />
    <style>
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
            color: #222;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #0056d6;
        }

        button {
            display: block;
            margin: 20px auto;
            padding: 10px 24px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            background: #0056d6;
            color: white;
            cursor: pointer;
            transition: 0.2s;
        }
        button:hover { background: #003ea8; }

        #progressContainer {
            width: 100%;
            background: #e0e0e0;
            border-radius: 8px;
            margin: 20px 0;
            height: 24px;
            overflow: hidden;
        }

        #progressBar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #00b894, #0984e3);
            transition: width 0.3s ease;
        }

        pre {
            background: #0d1117;
            color: #c9d1d9;
            padding: 15px;
            border-radius: 10px;
            height: 300px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.4;
        }

        .status {
            text-align: center;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .status.error { color: #e74c3c; }
        .status.success { color: #2ecc71; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Yandex Vision)</h1>
        <div class="status" id="statusMsg">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...</div>

        <button id="startBtn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>

        <div id="progressContainer">
            <div id="progressBar"></div>
        </div>

        <pre id="log">–õ–æ–≥ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</pre>
    </div>

    <script>
        const startBtn = document.getElementById("startBtn");
        const logEl = document.getElementById("log");
        const statusMsg = document.getElementById("statusMsg");
        const progressBar = document.getElementById("progressBar");

        function log(msg, color="#c9d1d9") {
            logEl.innerHTML += `<span style="color:${color}">${msg}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function startAnalyze() {
            startBtn.disabled = true;
            statusMsg.textContent = "üîÑ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...";
            statusMsg.className = "status";

            logEl.textContent = "";
            progressBar.style.width = "0%";

            try {
                const imageList = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):");
                if (!imageList) {
                    log("‚ö†Ô∏è –ê–Ω–∞–ª–∏–∑ –æ—Ç–º–µ–Ω—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º", "#f1c40f");
                    statusMsg.textContent = "–û—Ç–º–µ–Ω–µ–Ω–æ";
                    startBtn.disabled = false;
                    return;
                }

                const images = imageList.split(",").map(s => s.trim());
                log(`üì¶ –ü–æ–ª—É—á–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${images.length}`);

                const res = await fetch("/analyze", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ images })
                });

                const data = await res.json();
                if (data.status !== "ok") {
                    throw new Error(data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ");
                }

                log("‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω...", "#2ecc71");

                let processed = 0;
                for (const result of data.results) {
                    processed++;
                    const percent = Math.round((processed / data.results.length) * 100);
                    progressBar.style.width = percent + "%";

                    if (result.status === "ok") {
                        log(`üü¢ [${processed}] ${result.image} ‚Üí ${result.text}`, "#2ecc71");
                    } else {
                        log(`üî¥ [${processed}] ${result.image} ‚Üí ${result.text}`, "#e74c3c");
                    }
                }

                log("üéâ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω!", "#00cec9");
                statusMsg.textContent = "‚úÖ –ì–æ—Ç–æ–≤–æ";
                statusMsg.className = "status success";

            } catch (err) {
                log("üí• –û—à–∏–±–∫–∞: " + err.message, "#e74c3c");
                statusMsg.textContent = "‚ùå –û—à–∏–±–∫–∞";
                statusMsg.className = "status error";
            }

            startBtn.disabled = false;
        }

        startBtn.addEventListener("click", startAnalyze);
    </script>
</body>
</html>
