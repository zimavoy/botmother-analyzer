<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äî Yandex Vision</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light text-center p-4">
  <div class="container">
    <h1 class="mb-4">üîç –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Yandex Vision API)</h1>

    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="images" id="images" multiple class="form-control mb-3">
      <button type="submit" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>
    </form>

    <div class="progress mt-4" style="height: 25px;">
      <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;">0%</div>
    </div>

    <h5 class="mt-3" id="statusText">–û–∂–∏–¥–∞–Ω–∏–µ...</h5>

    <div class="mt-4 text-start">
      <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
      <ul id="results" class="list-group"></ul>
    </div>

    <div class="mt-4 text-start">
      <h4>–ñ—É—Ä–Ω–∞–ª –∞–Ω–∞–ª–∏–∑–∞:</h4>
      <pre id="logOutput" class="bg-dark text-white p-3 rounded"></pre>
    </div>
  </div>

  <script>
    const form = document.getElementById("uploadForm");
    const progressBar = document.getElementById("progressBar");
    const statusText = document.getElementById("statusText");
    const resultsList = document.getElementById("results");
    const logOutput = document.getElementById("logOutput");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      resultsList.innerHTML = "";
      logOutput.textContent = "";
      progressBar.style.width = "0%";
      statusText.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑...";

      fetch("/analyze", { method: "POST", body: formData })
        .then((res) => res.json())
        .then((data) => {
          data.forEach(item => {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.textContent = `${item.filename}: ${item.result}`;
            resultsList.appendChild(li);
          });
        });
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    setInterval(async () => {
      const res = await fetch("/progress");
      const data = await res.json();
      const percent = Math.floor((data.current / data.total) * 100) || 0;
      progressBar.style.width = percent + "%";
      progressBar.textContent = percent + "%";
      statusText.textContent = data.status;

      const logs = await fetch("/logs").then(r => r.json());
      logOutput.textContent = logs.logs.join("\n");
    }, 1000);
  </script>
</body>
</html>
